<!DOCTYPE HTML>
<html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DLaxV Shot Clock</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚è±Ô∏è</text></svg>">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/fontawesome-all.min.css" rel="stylesheet">
  <style>
    body {
      background: rgb(158, 158, 158);
      background: radial-gradient(circle, rgba(158, 158, 158, 1) 0%, rgba(117, 117, 117, 1) 35%, rgba(66, 66, 66, 1) 100%);
    }

    #logos img {
      height: 7.5vmax;
    }

    .a-button {
      color: inherit;
      text-decoration: none;
    }
  </style>
</head>

<body>
  <div class="p-5 text-center">
    <div class="d-flex flex-column justify-content-center align-items-center h-100">
      <div class="text-white mb-2">
        <h1 class="mb-3">DLaxV Shot Clock</h1>
        <h5 class="mb-4">Free & Open Source online shot clock application</h5>
        <input id="room" type="text" class="form-control" placeholder="Room Name">
        <select name="lang" id="lang" class="btn btn-outline-light btn-lg m-2">
          <option value="en">üá∫üá∏</option>
          <option value="de">üá©üá™</option>
        </select>
        <button id="infoButton" class="btn btn-outline-light btn-lg m-2" role="button" data-bs-toggle="modal"
          data-bs-target="#infoModalEN">
          <span class="lang-en d-none">Instructions</span>
          <span class="lang-de d-none">Anleitung</span>
        </button>
        <button id="createButton" class="btn btn-outline-light btn-lg m-2" role="button" onclick="create();">
          <span class="lang-en d-none">Create Room</span>
          <span class="lang-de d-none">Raum erstellen</span>
        </button>
      </div>
      <div id="room-info" class="mb-2 d-flex flex-row d-none">
        <div id="qr" class="mx-1 my-1"></div>
        <div id="room-buttons" class="d-flex flex-column justify-content-around mx-1">
          <div class="d-flex">
            <div class="d-flex flex-column">
              <a id="url-room" class="btn btn-outline-light btn-md my-1" role="button" target="_blank"
                href="https://shotclock.dlaxv.de/room.html?r=">
                <span class="lang-en d-none">Open Room</span>
                <span class="lang-de d-none">Raum √∂ffnen</span>
              </a>
              <button id="copy-url-room" class="btn btn-outline-light btn-md" role="button" onclick="copyRoomURL();">
                <span class="lang-en d-none">Copy Room URL</span>
                <span class="lang-de d-none">Raum-URL kopieren</span>
              </button>
            </div>
            <div class="d-flex flex-column justify-content-center ms-2">
              <div id="roomUrlInfo" onclick="showRoomUrlInfo()">
                <i class="fas fa-info-circle fa-2x text-white"></i>
              </div>
            </div>
          </div>
          <div class="d-flex">
            <div class="d-flex flex-column">
              <a id="url-control" class="btn btn-outline-light btn-md my-1" role="button" target="_blank"
                href="https://shotclock.dlaxv.de/control.html?r=">
                <span class="lang-en d-none">Open Control</span>
                <span class="lang-de d-none">Steuerung √∂ffnen</span>
              </a>
              <button id="copy-url-control" class="btn btn-outline-light btn-md" role="button"
                onclick="copyControlURL();">
                <span class="lang-en d-none">Copy Control URL</span>
                <span class="lang-de d-none">Steuerungs-URL kopieren</span>
              </button>
            </div>
            <div class="d-flex flex-column justify-content-center ms-2">
              <div id="controlUrlInfo" onclick="showControlUrlInfo()">
                <i class="fas fa-info-circle fa-2x text-white"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="supported-by" class="mt-5">
        <h4 class="text-white mb-4">Supported by</h4>
        <div id="logos" class="d-flex flex-row align-items-center">
          <div id="logo-dlaxv" class="mx-3">
            <a href="https://dlaxv.de/" target="_blank"><img src="img/logo-dlaxv.svg" alt="Logo DLaxV"></a>
          </div>
          <div id="logo-worldlacrosse" class="mx-3">
            <a href="https://worldlacrosse.sport/" target="_blank"><img src="img/logo-worldlacrosse.svg"
                alt="Logo World Lacrosse"></a>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- Info Modal -->
  <div id="infoModalDE" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content" class="lang-de">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">Info / How To Online Shot Clock</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Willkommen auf der DLaxV Online Shot Clock!
          <br />
          Hier k√∂nnen R√§ume erstellt werden in denen allen Nutzern im selben Raum die gleiche Zeit angezeigt wird.
          <br />
          Der Raumname muss eindeutig gew√§hlt werden, sonst kommt es zu Kollisionen mit anderen Nutzern.
          Vorschlag: <b>Heimteam-Gegner-Uhrzeit</b>

          <br /><br />
          Auf der Startseite kann durch Eingabe eines Raumnamens und Klick auf den Button <b>Raum erstellen</b> ein Raum
          erstellt werden.
          Folgende Informationen werden anschlie√üend angezeigt:
          <ul>
            <li>Button zum √ñffnen des Raums</li>
            <li>Button zum Kopieren der Raum-URL</li>
            <li>Button zum √ñffnen Steuerungseite des Raums</li>
            <li>Button zum Kopieren der Steuerungs-URL</li>
            <li>QR-Code zur Raum-URL</li>
          </ul>
          Die jeweiligen Teams, Trainer*innen, Zuschauer*innen k√∂nnen √ºber die Raum-URL oder den QR-Code dem Raum
          beitreten und die Shot Clock, die f√ºr das Spiel gilt, sehen.
          Die Shot Clock kann auf allen Endger√§ten mit Internetbrowser und Zugang zum Internet angezeigt werden.

          <br /><br />
          Auf der Steuerungsseite kann die Shot Clock √ºber die dort vorhandenen Buttons gesteuert werden.
          <br />
          Eine m√∂gliche Bildschirmsperre oder Bildschirmschonerzeit des Endger√§ts sollte dementsprechend angepasst
          werden, damit die Seite aktiv bleibt.

          <br /><br />
          Die Audioausgabe (Piepton) bei Ablauf der Uhr ist aus technischen Gr√ºnden nur m√∂glich, wenn vom Nutzer mit
          der
          Seite interagiert wird.
          Also entweder auf der Steuerungs-Seite oder auf der Raum-Seite, wenn dort einmal irgendwo in die Seite
          geklickt wird.
          <br />
          Es empfiehlt sich einen Lautsprecher (z.B. Bluetooth-Box) an das Ger√§t, auf dem die Shot Clock gesteuert
          wird,
          anzuschlie√üen um von dort den Piepton f√ºr alle Anwesenden abzuspielen.

          <hr />
          <h3>Beispielhaftes Setup</h3>
          <img src="img/instructions.svg" alt="Instructional image for device setup" class="w-100">
        </div>
      </div>
    </div>
  </div>
  <div id="infoModalEN" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content" class="lang-en">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">Info / How To Online Shot Clock</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Welcome to the DLaxV Online Shot Clock!
          <br />
          Here you can create rooms in which all users in the same room are shown the same shot clock time.
          <br />
          The room name must be chosen uniquely, otherwise there will be collisions with other users. Suggestion:
          <b>Hometeam-Opponent-Time</b>

          <br /><br />
          On the home page, a room can be created by entering a room name and clicking the <b>Create Room</b> button.
          The
          following information will be displayed afterwards:
          <ul>
            <li>Button to open the room</li>
            <li>Button to copy the room URL</li>
            <li>Button to open the control page of the room</li>
            <li>Button to copy the control URL</li>
            <li>QR code for the room URL</li>
          </ul>
          The respective teams, coaches and spectators can join the room via the room URL or the QR code and see the
          shot clock that applies to the game. The shot clock can be viewed on any device with an internet browser and
          access to the internet.

          <br /><br />
          On the control page, the shot clock can be controlled using the buttons available there.
          <br />
          A possible screen lock or screen saver time of the end device should be adjusted accordingly so that the page
          remains active.

          <br /><br />
          For technical reasons, the audio output (beep) when the clock expires is only possible if the user interacts
          with the page.
          So either on the control page or on the room page, the beep will sound only if the user clicks/touches
          somewhere in the page once.
          <br />
          It is recommended to connect a loudspeaker (e.g. Bluetooth box) to the device on which the shot clock is
          controlled in order to play the beep from there for everyone present.

          <hr />
          <h3>Example Setup</h3>
          <img src="img/instructions.svg" alt="Instructional image for device setup" class="w-100">
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script type="application/javascript" src="js/qrcode.min.js"></script>
  <script>
    let lang;

    $(document).ready(function () {
      params = new URLSearchParams(window.location.search);
      room = params.get('r');
      if (room !== undefined && room !== null && room.trim() !== "")
        document.getElementById("room").value = room;
      create(false);

      lang = params.get("lang");
      if (lang === "de") {
        $('#lang').val("de");
        $('#infoButton').attr("data-bs-target", "#infoModalDE")
        $('.lang-de').removeClass("d-none");
      } else {
        $('#lang').val("en");
        $('#infoButton').attr("data-bs-target", "#infoModalEN")
        $('.lang-en').removeClass("d-none");
      }
    });

    $('#lang').change(function (value) {
      window.location.href = replaceUrlParam(window.location.href, "lang", $('#lang').val());
    });

    function replaceUrlParam(url, paramName, paramValue) {
      if (paramValue == null)
        paramValue = '';
      var pattern = new RegExp('\\b(' + paramName + '=).*?(&|#|$)');
      if (url.search(pattern) >= 0)
        return url.replace(pattern, '$1' + paramValue + '$2');
      url = url.replace(/[?#]$/, '');
      return url + (url.indexOf('?') > 0 ? '&' : '?') + paramName + '=' + paramValue;
    }

    let createButtonTimeoutId;
    function create(showPopover = true) {
      var room = $('#room').val();
      if (room !== undefined && room !== null && room.trim() !== "") {
        history.pushState({}, null, replaceUrlParam(window.location.href, "r", room));

        // Room-Info zeigen
        $('#room-info').removeClass('d-none');

        // Popover auf Create Button deaktivieren
        $('#createButton').popover('hide');

        // Buttons und QR-Code best√ºcken
        var url = createRoomURL(room);
        setQR(url);
        $('#url-room').attr("href", url);

        var controlUrl = createControlURL(room);
        $('#url-control').attr("href", controlUrl);
      } else if (showPopover) {
        clearTimeout(createButtonTimeoutId);
        $('#createButton').popover({
          content: "Please define a room name",
          trigger: 'manual'
        });
        $('#createButton').popover('show');
        createButtonTimeoutId = setTimeout(function () {
          $('#createButton').popover('hide');
        }, 3000);
      }
    }

    function showControlUrlInfo() {
      let text;
      if (lang === "de")
        text = "Auf dieser Seite kann der User die Shot Clock steuern";
      else
        text = "This page allows the user to control the shot clock";
      $('#controlUrlInfo').popover({
        content: text,
        trigger: 'manual'
      });
      $('#controlUrlInfo').popover('show');
      createButtonTimeoutId = setTimeout(function () {
        $('#controlUrlInfo').popover('hide');
      }, 10000);
    }

    function showRoomUrlInfo() {
      let text;
      if (lang === "de")
        text = "Auf dieser Seite k√∂nnen die User die Shot Clock live verfolgen";
      else
        text = "This page allows users to view the shot clock live";
      $('#roomUrlInfo').popover({
        content: text,
        trigger: 'manual'
      });
      $('#roomUrlInfo').popover('show');
      createButtonTimeoutId = setTimeout(function () {
        $('#roomUrlInfo').popover('hide');
      }, 10000);
    }

    function copyRoomURL() {
      var room = $('#room').val();
      if (room !== undefined && room !== null && room.trim() !== "") {
        navigator.clipboard.writeText(createRoomURL(room));
        $('#copy-url-room').popover({
          content: "Copied!",
        });
        $('#copy-url-room').popover('show');
        setTimeout(function () {
          $('#copy-url-room').popover('hide');
        }, 1000);
      }
    }

    function copyControlURL() {
      var room = $('#room').val();
      if (room !== undefined && room !== null && room.trim() !== "") {
        navigator.clipboard.writeText(createControlURL(room));
        $('#copy-url-control').popover({
          content: "Copied!",
        });
        $('#copy-url-control').popover('show');
        setTimeout(function () {
          $('#copy-url-control').popover('hide');
        }, 1000);
      }
    }

    function createRoomURL(room) {
      return "https://shotclock.dlaxv.de/room.html?r=" + room;
    }

    function createControlURL(room) {
      return "https://shotclock.dlaxv.de/control.html?r=" + room;
    }

    var qrcode;
    function setQR(url) {
      var size = Math.min(window.innerWidth, window.innerHeight) / 4;
      if (qrcode === undefined) {
        qrcode = new QRCode("qr", {
          text: url,
          width: size,
          height: size,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
      } else {
        qrcode.makeCode(url);
      }
    }

    function openControls() {
      var room = $('#room').val();
      if (room !== undefined && room !== null && room.trim() !== "")
        window.location.href = createControlURL(room);
    }
  </script>
</body>

</html>